[![](https://mermaid.ink/img/eyJjb2RlIjoiZ3JhcGggVEJcbiAgICBTdGF0dXNDaGVjay0tPmNyZWF0ZXNNYWluLnRmRnJvbUppbmphMlRlbXBsYXRlXG4gICAgc3ViZ3JhcGggcHlbcHl0aG9uXVxuICAgIGNyZWF0ZXNNYWluLnRmRnJvbUppbmphMlRlbXBsYXRlLS0-IFRlcnJhZm9ybU1haW4udGZBdmFpbGFibGUgXG4gICAgZW5kXG4gICAgVGVycmFmb3JtTWFpbi50ZkF2YWlsYWJsZS0tPlByb3Zpc2lvbmluZ1ZtXG4gICAgc3ViZ3JhcGggdGZbdGVycmFmb3JtXVxuICAgIFByb3Zpc2lvbmluZ1ZtIC0tPiBjb2xsZWN0c1ZtSW5mb3JtYXRpb24gLS0-IE1haW4udGZHZW5lcmF0ZXNBbnNpYmxlSW52ZW50b3J5XG4gICAgZW5kXG4gICAgTWFpbi50ZkdlbmVyYXRlc0Fuc2libGVJbnZlbnRvcnkgLS0-IHNzaEludG9WbXNcbiAgICBzdWJncmFwaCBhbnNpYmxlW2Fuc2libGVTdGFydF1cbiAgICBzc2hJbnRvVm1zIC0tPiBJbnN0YWxsc0Fuc2libGVSb2xlc1xuICAgIGVuZFxuICAgIEluc3RhbGxzQW5zaWJsZVJvbGVzIC0tPiBSb2xlc1N0YXJ0XG4gICAgc3ViZ3JhcGggbmF0W25hdF1cbiAgICBSb2xlc1N0YXJ0IC0tPiBGaXJld2FsbCAtLT4gVlBOXG4gICAgZW5kXG4gICAgc3ViZ3JhcGggY29tbW9uW2NvbW1vbl1cbiAgICBSb2xlc1N0YXJ0IC0tPiBjb21tb25Db25maWd1cmF0aW9uXG4gICAgZW5kIiwibWVybWFpZCI6e30sInVwZGF0ZUVkaXRvciI6ZmFsc2V9)](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoiZ3JhcGggVEJcbiAgICBTdGF0dXNDaGVjay0tPmNyZWF0ZXNNYWluLnRmRnJvbUppbmphMlRlbXBsYXRlXG4gICAgc3ViZ3JhcGggcHlbcHl0aG9uXVxuICAgIGNyZWF0ZXNNYWluLnRmRnJvbUppbmphMlRlbXBsYXRlLS0-IFRlcnJhZm9ybU1haW4udGZBdmFpbGFibGUgXG4gICAgZW5kXG4gICAgVGVycmFmb3JtTWFpbi50ZkF2YWlsYWJsZS0tPlByb3Zpc2lvbmluZ1ZtXG4gICAgc3ViZ3JhcGggdGZbdGVycmFmb3JtXVxuICAgIFByb3Zpc2lvbmluZ1ZtIC0tPiBjb2xsZWN0c1ZtSW5mb3JtYXRpb24gLS0-IE1haW4udGZHZW5lcmF0ZXNBbnNpYmxlSW52ZW50b3J5XG4gICAgZW5kXG4gICAgTWFpbi50ZkdlbmVyYXRlc0Fuc2libGVJbnZlbnRvcnkgLS0-IHNzaEludG9WbXNcbiAgICBzdWJncmFwaCBhbnNpYmxlW2Fuc2libGVTdGFydF1cbiAgICBzc2hJbnRvVm1zIC0tPiBJbnN0YWxsc0Fuc2libGVSb2xlc1xuICAgIGVuZFxuICAgIEluc3RhbGxzQW5zaWJsZVJvbGVzIC0tPiBSb2xlc1N0YXJ0XG4gICAgc3ViZ3JhcGggbmF0W25hdF1cbiAgICBSb2xlc1N0YXJ0IC0tPiBGaXJld2FsbCAtLT4gVlBOXG4gICAgZW5kXG4gICAgc3ViZ3JhcGggY29tbW9uW2NvbW1vbl1cbiAgICBSb2xlc1N0YXJ0IC0tPiBjb21tb25Db25maWd1cmF0aW9uXG4gICAgZW5kIiwibWVybWFpZCI6e30sInVwZGF0ZUVkaXRvciI6ZmFsc2V9)

```
graph TB
    StatusCheck-->createsMain.tfFromJinja2Template
    subgraph py[python]
    createsMain.tfFromJinja2Template--> TerraformMain.tfAvailable 
    end
    TerraformMain.tfAvailable-->ProvisioningVm
    subgraph tf[terraform]
    ProvisioningVm --> collectsVmInformation --> Main.tfGeneratesAnsibleInventory
    end
    Main.tfGeneratesAnsibleInventory --> sshIntoVms
    subgraph ansible[ansibleStart]
    sshIntoVms --> InstallsAnsibleRoles
    end
    InstallsAnsibleRoles --> RolesStart
    subgraph nat[nat]
    RolesStart --> Firewall --> VPN
    end
    subgraph common[common]
    RolesStart --> commonConfiguration
    end
```